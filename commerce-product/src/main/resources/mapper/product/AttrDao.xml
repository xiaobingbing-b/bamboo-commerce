<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bamboo.commerce.product.dao.AttrDao">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.bamboo.commerce.product.entity.AttrEntity" id="attrMap">
        <result property="attrId" column="attr_id"/>
        <result property="attrName" column="attr_name"/>
        <result property="searchType" column="search_type"/>
        <result property="icon" column="icon"/>
        <result property="valueSelect" column="value_select"/>
        <result property="attrType" column="attr_type"/>
        <result property="enable" column="enable"/>
        <result property="catelogId" column="catelog_id"/>
        <result property="showDesc" column="show_desc"/>
    </resultMap>
    <select id="queryForPage" resultType="com.bamboo.commerce.product.vo.AttrVo" parameterType="java.util.Map">
        SELECT
        a.*,
        b.attr_group_id AS attrGroupId,
        c.attr_group_name AS attrGroupName,
        d.name AS catelogName
        FROM
        pms_attr a
        LEFT JOIN pms_attr_attrgroup_relation b ON a.attr_id = b.attr_id
        LEFT JOIN pms_attr_group c on b.attr_group_id = c.attr_group_id
        LEFT JOIN pms_category d on a.catelog_id = d.cat_id AND d.show_status = '1'
        <where>
            <if test="params.catelogId != null and params.catelogId != 0">
                a.catelog_id = #{params.catelogId}
            </if>
            <if test="params.attrType != null and params.attrType != ''">
                AND a.attr_type = #{params.attrType}
            </if>
            <if test="params.key != null and params.key != ''">
                AND (a.attr_id = #{params.key} or a.attr_name like concat('%', #{params.key}, '%'))
            </if>
        </where>
    </select>

    <select id="getAttrVoInfoById" resultType="com.bamboo.commerce.product.vo.AttrVo" parameterType="java.lang.Long">
        SELECT
	    a.*,
	    b.attr_group_id
        FROM
	    pms_attr a
	    LEFT JOIN pms_attr_attrgroup_relation b ON a.attr_id = b.attr_id
	    WHERE a.attr_id = #{attrId}
	    LIMIT 0,1
    </select>

    <select id="getAttrByGroupId" resultType="java.util.Map" parameterType="java.lang.Long">
        SELECT
	        a.attr_name,
	        a.value_select
        FROM
	        pms_attr a
        WHERE
	        a.attr_id IN (
	        SELECT
		        t.attr_id
	        FROM
		        pms_attr_attrgroup_relation t
            WHERE
	        t.attr_group_id = #{groupId})
    </select>
    <select id="getNoBindAttr" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
	        attr_id,
	        attr_name,
            value_select
        FROM
	        pms_attr
        <where>
            <if test="null != params.catelogId">
                AND catelog_id = #{params.catelogId}
            </if>
            <if test="null != params.attrType">
                AND attr_type = #{params.attrType}
            </if>
            <if test="null != params.groupId">
                AND attr_id NOT IN ( SELECT attr_id FROM pms_attr_attrgroup_relation WHERE attr_group_id = #{params.groupId} )
            </if>
        </where>
    </select>


</mapper>